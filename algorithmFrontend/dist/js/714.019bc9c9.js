"use strict";(self["webpackChunkvue_django_frontend"]=self["webpackChunkvue_django_frontend"]||[]).push([[714],{5714:function(e,t,o){o.r(t),o.d(t,{default:function(){return J}});var n=o(6768),a=o(5130);const i={class:"draft-update-view"},l={class:"page-container"},s={key:0,class:"loading-container"},r={key:1,class:"error-container"},u={key:2,class:"solution-content"},d={class:"question-input"},c={class:"markdown-editor"},h=["innerHTML"],m={class:"dialog-footer"};function f(e,t,o,f,g,p){const b=(0,n.g2)("AppHeader"),_=(0,n.g2)("el-skeleton"),k=(0,n.g2)("el-alert"),v=(0,n.g2)("el-input"),y=(0,n.g2)("el-button"),x=(0,n.g2)("el-form-item"),w=(0,n.g2)("el-option"),q=(0,n.g2)("el-select"),J=(0,n.g2)("el-switch"),F=(0,n.g2)("el-tab-pane"),I=(0,n.g2)("el-tabs"),V=(0,n.g2)("el-form"),C=(0,n.g2)("el-dialog");return(0,n.uX)(),(0,n.CE)("div",i,[(0,n.bF)(b),(0,n.Lk)("main",l,[t[12]||(t[12]=(0,n.Lk)("h1",null,"编辑草稿",-1)),g.loading?((0,n.uX)(),(0,n.CE)("div",s,[(0,n.bF)(_,{rows:10,animated:""})])):g.error?((0,n.uX)(),(0,n.CE)("div",r,[(0,n.bF)(k,{title:g.error,type:"error",closable:!1},null,8,["title"])])):((0,n.uX)(),(0,n.CE)("div",u,[(0,n.bF)(V,{model:g.form,"label-width":"120px",class:"solution-form"},{default:(0,n.k6)((()=>[(0,n.bF)(x,{label:"题目ID"},{default:(0,n.k6)((()=>[(0,n.Lk)("div",d,[(0,n.bF)(v,{modelValue:g.form.question_id,"onUpdate:modelValue":t[0]||(t[0]=e=>g.form.question_id=e),placeholder:"输入题目ID",onBlur:p.fetchQuestionInfo},null,8,["modelValue","onBlur"]),(0,n.bF)(y,{type:"primary",icon:"el-icon-link",disabled:!g.form.question_id,onClick:p.goToProblem,title:"前往题目页面"},{default:(0,n.k6)((()=>t[8]||(t[8]=[(0,n.eW)(" 查看题目 ")]))),_:1},8,["disabled","onClick"])])])),_:1}),(0,n.bF)(x,{label:"题目名称"},{default:(0,n.k6)((()=>[(0,n.bF)(v,{modelValue:g.form.question_name,"onUpdate:modelValue":t[1]||(t[1]=e=>g.form.question_name=e),disabled:"",placeholder:"获取题目名称"},null,8,["modelValue"])])),_:1}),(0,n.bF)(x,{label:"语言类型"},{default:(0,n.k6)((()=>[(0,n.bF)(q,{modelValue:g.form.language,"onUpdate:modelValue":t[2]||(t[2]=e=>g.form.language=e),placeholder:"选择编程语言",class:"w-100"},{default:(0,n.k6)((()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(g.languageOptions,(e=>((0,n.uX)(),(0,n.Wv)(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,n.bF)(x,{label:"是否为草稿"},{default:(0,n.k6)((()=>[(0,n.bF)(J,{modelValue:g.form.is_draft,"onUpdate:modelValue":t[3]||(t[3]=e=>g.form.is_draft=e)},null,8,["modelValue"])])),_:1}),(0,n.bF)(x,{label:"题解内容"},{default:(0,n.k6)((()=>[(0,n.Lk)("div",c,[(0,n.bF)(I,{modelValue:g.activeTab,"onUpdate:modelValue":t[5]||(t[5]=e=>g.activeTab=e)},{default:(0,n.k6)((()=>[(0,n.bF)(F,{label:"编辑",name:"edit"},{default:(0,n.k6)((()=>[(0,n.bo)((0,n.Lk)("textarea",{"onUpdate:modelValue":t[4]||(t[4]=e=>g.form.content_text=e),class:"editor-textarea",placeholder:"输入题解内容（Markdown格式）"},null,512),[[a.Jo,g.form.content_text]])])),_:1}),(0,n.bF)(F,{label:"预览",name:"preview"},{default:(0,n.k6)((()=>[(0,n.Lk)("div",{ref:"markdownPreview",class:"markdown-preview",innerHTML:p.compiledMarkdown},null,8,h)])),_:1})])),_:1},8,["modelValue"])])])),_:1}),(0,n.bF)(x,null,{default:(0,n.k6)((()=>[(0,n.bF)(y,{type:"primary",onClick:p.handleSubmit,loading:g.submitting},{default:(0,n.k6)((()=>t[9]||(t[9]=[(0,n.eW)("更新")]))),_:1},8,["onClick","loading"]),(0,n.bF)(y,{onClick:p.handleReset,disabled:g.submitting},{default:(0,n.k6)((()=>t[10]||(t[10]=[(0,n.eW)("重置")]))),_:1},8,["onClick","disabled"]),(0,n.bF)(y,{type:"danger",onClick:p.handleDelete,disabled:g.submitting},{default:(0,n.k6)((()=>t[11]||(t[11]=[(0,n.eW)("删除")]))),_:1},8,["onClick","disabled"])])),_:1})])),_:1},8,["model"])]))]),(0,n.bF)(C,{modelValue:g.deleteDialogVisible,"onUpdate:modelValue":t[7]||(t[7]=e=>g.deleteDialogVisible=e),title:"确认删除",width:"30%"},{footer:(0,n.k6)((()=>[(0,n.Lk)("span",m,[(0,n.bF)(y,{onClick:t[6]||(t[6]=e=>g.deleteDialogVisible=!1)},{default:(0,n.k6)((()=>t[13]||(t[13]=[(0,n.eW)("取消")]))),_:1}),(0,n.bF)(y,{type:"danger",onClick:p.confirmDelete,loading:g.processing},{default:(0,n.k6)((()=>t[14]||(t[14]=[(0,n.eW)("确认删除")]))),_:1},8,["onClick","loading"])])])),default:(0,n.k6)((()=>[t[15]||(t[15]=(0,n.Lk)("span",null,"确定要删除这篇草稿吗？此操作不可逆。",-1))])),_:1},8,["modelValue"])])}o(4114);var g=o(6493),p=o(8121),b=o(2846),_=o(1184),k=o(642),v=o(8353),y=o(1219),x={name:"SolutionUpdateView",components:{AppHeader:g.A},data(){return{solutionId:this.$route.params.id,originalSolution:null,loading:!0,error:null,submitting:!1,processing:!1,fetching:!1,deleteDialogVisible:!1,mathJaxLoaded:!1,activeTab:"edit",form:{question_id:"",question_name:"",language:"",content_text:"",is_draft:!1},mdi:new k.A({html:!0,linkify:!0,typographer:!0,breaks:!0}),languageOptions:[{value:"python",label:"Python"},{value:"java",label:"Java"},{value:"cpp",label:"C++"},{value:"javascript",label:"JavaScript"},{value:"csharp",label:"C#"},{value:"go",label:"Go"},{value:"rust",label:"Rust"}]}},computed:{compiledMarkdown(){try{const e=String(this.form.content_text||""),t=this.mdi.render(e);return v.A.sanitize(t)}catch(e){return console.error("Markdown处理错误:",e),"内容解析出错"}}},watch:{activeTab(e){"preview"===e&&(this.initMathJax(),this.$nextTick((()=>this.renderMathJax())))},"form.content_text"(){"preview"===this.activeTab&&this.mathJaxLoaded&&this.$nextTick((()=>this.renderMathJax()))}},created(){console.log("组件创建，题解ID:",this.solutionId)},mounted(){console.log("组件挂载，获取题解ID:",this.solutionId),this.fetchSolutionDetail(),this.initMathJax()},methods:{async fetchSolutionDetail(){this.loading=!0,this.error=null;try{console.log("正在获取题解详情，ID:",this.solutionId);const e=await(0,p.n6)(this.solutionId);console.log("题解API返回完整响应:",JSON.stringify(e));let t=e;e.data&&(t=200===e.data.code?e.data.data:e.data),console.log("提取的题解数据:",JSON.stringify(t)),this.originalSolution={...t},console.log("数据字段名称检查:");for(const o in t)console.log(`- ${o}: ${JSON.stringify(t[o])}`);this.form={question_id:t.question_id||"",question_name:t.question_name||"",language:t.language||"",content_text:t.content_text||t.content||"",is_draft:!!t.is_draft},console.log("表单数据已填充:",JSON.stringify(this.form)),this.form.question_id&&!this.form.question_name&&await this.fetchQuestionInfo()}catch(e){console.error("获取草稿详情失败:",e),this.error="获取草稿详情失败: "+(e.message||"未知错误")}finally{this.loading=!1}},async fetchQuestionInfo(){if(this.form.question_id){this.fetching=!0;try{console.log("获取题目信息，ID:",this.form.question_id);const e=await(0,b.so)(this.form.question_id);console.log("题目详情响应:",JSON.stringify(e));let t=e;e.data&&(t=200===e.data.code?e.data.data:e.data),this.form.question_name=t.name||t.question_name||"",console.log("设置题目名称:",this.form.question_name)}catch(e){console.error("获取题目信息失败:",e),y.nk.error("获取题目信息失败: "+(e.message||"未知错误")),this.form.question_name=""}finally{this.fetching=!1}}else this.form.question_name=""},goToProblem(){this.form.question_id&&this.$router.push(`/${this.form.question_id}/problems`)},initMathJax(){if(this.mathJaxLoaded||"undefined"!==typeof MathJax)return void(this.mathJaxLoaded=!0);window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,tags:"ams"},options:{enableMenu:!1,skipHtmlTags:["script","noscript","style","textarea","pre","code"],processHtmlClass:"markdown-content"},svg:{fontCache:"global"},startup:{ready:()=>{window.MathJax.startup.defaultReady(),this.mathJaxLoaded=!0,this.form.content_text&&"preview"===this.activeTab&&this.$nextTick((()=>this.renderMathJax()))}}};const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js",e.async=!0,e.onload=()=>{console.log("MathJax脚本加载完成")},e.onerror=()=>{console.error("MathJax脚本加载失败，尝试备用CDN");const e=document.createElement("script");e.src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-svg.js",e.async=!0,document.head.appendChild(e)},document.head.appendChild(e)},renderMathJax(){if("undefined"!==typeof MathJax&&MathJax.typesetPromise){const e=this.$refs.markdownPreview;if(!e)return;MathJax.typesetPromise([e]).catch((e=>{console.error("MathJax公式渲染错误:",e)}))}},validateForm(){return this.form.question_id?this.form.language?!!this.form.content_text||(y.nk.error("请输入题解内容"),!1):(y.nk.error("请选择编程语言"),!1):(y.nk.error("请输入题目ID"),!1)},async handleSubmit(){if(this.validateForm()){this.submitting=!0;try{const e={question_id:this.form.question_id,language:this.form.language,content_text:this.form.content_text,is_draft:this.form.is_draft};console.log("准备更新草稿，ID:",this.solutionId,"数据:",e);const t=await(0,p.jA)(this.solutionId,e);console.log("更新成功，响应:",t),(0,y.nk)({type:"success",message:"草稿更新成功"}),this.form.is_draft?this.$router.push(`/${this.solutionId}/drafts`):this.$router.push(`/${this.solutionId}/solutions`),this.fetchSolutionDetail()}catch(e){console.error("更新题解失败:",e),(0,y.nk)({type:"error",message:e.response?.data?.message||e.message||"更新失败: 未知错误"})}finally{this.submitting=!1}}},handleReset(){this.originalSolution&&(this.form={question_id:this.originalSolution.question_id||"",question_name:this.originalSolution.question_name||"",language:this.originalSolution.language||"",content_text:this.originalSolution.content_text||this.originalSolution.content||"",is_draft:!!this.originalSolution.is_draft},(0,y.nk)({type:"info",message:"已重置为原始数据"}))},handleDelete(){this.deleteDialogVisible=!0},async confirmDelete(){this.processing=!0;try{console.log("准备删除草稿，ID:",this.solutionId);const e=await(0,_.A)({url:"/api/solution/delete/",method:"post",data:{id:this.solutionId}});console.log("删除成功，响应:",e),this.deleteDialogVisible=!1,(0,y.nk)({type:"success",message:e.message||"草稿删除成功"}),this.$router.push("/solutions")}catch(e){console.error("删除草稿失败:",e);const t=e.response?.data?.message||e.message||"删除失败: 未知错误";(0,y.nk)({type:"error",message:t})}finally{this.processing=!1}}}},w=o(1241);const q=(0,w.A)(x,[["render",f],["__scopeId","data-v-5d298d76"]]);var J=q},8121:function(e,t,o){o.d(t,{J1:function(){return c},Nc:function(){return r},R1:function(){return h},S1:function(){return l},Tu:function(){return d},Up:function(){return a},_n:function(){return i},jA:function(){return m},n6:function(){return u},uA:function(){return s}});var n=o(1184);function a(e){return(0,n.A)({url:"/api/solutions/",method:"get",params:e})}function i(e){return(0,n.A)({url:"/api/solutions/trash/",method:"get",params:e})}function l(e){return(0,n.A)({url:"/api/drafts/",method:"get",params:e})}function s(e){return(0,n.A)({url:"/api/drafts/trash/",method:"get",params:e})}function r(e){return(0,n.A)({url:`/solutions/${e}/`,method:"get"})}function u(e){return(0,n.A)({url:`/drafts/${e}/`,method:"get"})}function d(e){return(0,n.A)({url:"/api/solution/create/",method:"post",data:e})}function c(e){return(0,n.A)({url:"/api/solution/draft/",method:"post",data:e})}function h(e,t){return(0,n.A)({url:`/solutions/${e}/update/`,method:"put",data:t})}function m(e,t){return(0,n.A)({url:`/drafts/${e}/update/`,method:"put",data:t})}}}]);
//# sourceMappingURL=714.019bc9c9.js.map