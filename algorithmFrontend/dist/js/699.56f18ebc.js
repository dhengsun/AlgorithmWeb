"use strict";(self["webpackChunkvue_django_frontend"]=self["webpackChunkvue_django_frontend"]||[]).push([[699],{2699:function(e,t,a){a.r(t),a.d(t,{default:function(){return le}});var i=a(6768),s=a(4232);const l={class:"draft-detail-view"},n={class:"page-container"},o={key:0,class:"loading-container"},r={key:1,class:"error-container"},d={key:2,class:"draft-content"},u={class:"left-section"},c={class:"deleted-banner"},f={class:"draft-title"},g={class:"draft-metadata"},p={class:"draft-time"},k={key:0,class:"draft-time"},h={class:"draft-language"},m={class:"draft-status"},_=["innerHTML"],y={class:"right-section"},b={class:"info-meta"},D={key:0},v={key:1},L={key:0,class:"action-buttons"},C={class:"difficulty-section"},q={key:0,class:"tags-section"},F={class:"tags-container"},w={key:3,class:"draft-content"},W={class:"left-section"},T={class:"draft-title"},V={class:"draft-metadata"},E={class:"draft-time"},X={key:0,class:"draft-time"},A={class:"draft-language"},z={class:"draft-status"},P=["innerHTML"],Q={class:"right-section"},j={class:"info-meta"},$={key:0},M={key:1},N={key:0,class:"action-buttons"},I={class:"difficulty-section"},R={key:0,class:"tags-section"},U={class:"tags-container"},S={class:"dialog-footer"},H={class:"dialog-footer"},O={class:"dialog-footer"};function x(e,t,a,x,J,K){const G=(0,i.g2)("AppHeader"),Z=(0,i.g2)("el-skeleton"),B=(0,i.g2)("el-alert"),Y=(0,i.g2)("el-tag"),ee=(0,i.g2)("el-card"),te=(0,i.g2)("RefreshLeft"),ae=(0,i.g2)("el-icon"),ie=(0,i.g2)("el-button"),se=(0,i.g2)("EditPen"),le=(0,i.g2)("View"),ne=(0,i.g2)("Upload"),oe=(0,i.g2)("Delete"),re=(0,i.g2)("el-dialog");return(0,i.uX)(),(0,i.CE)("div",l,[(0,i.bF)(G),(0,i.Lk)("main",n,[J.loading?((0,i.uX)(),(0,i.CE)("div",o,[(0,i.bF)(Z,{rows:10,animated:""})])):J.error?((0,i.uX)(),(0,i.CE)("div",r,[(0,i.bF)(B,{title:J.error,type:"error",closable:!1},null,8,["title"])])):J.draft&&J.draft.is_deleted?((0,i.uX)(),(0,i.CE)("div",d,[(0,i.Lk)("div",u,[(0,i.bF)(ee,{class:"draft-description-card"},{default:(0,i.k6)((()=>[(0,i.Lk)("div",c,[(0,i.bF)(B,{title:"此草稿已被删除",type:"warning",closable:!1})]),(0,i.Lk)("h1",f,"题目 #"+(0,s.v_)(J.draft.question_id)+" 的解题思路（草稿）",1),(0,i.Lk)("div",g,[(0,i.Lk)("span",p,[t[10]||(t[10]=(0,i.Lk)("i",{class:"el-icon-time"},null,-1)),(0,i.eW)(" 创建于: "+(0,s.v_)(K.formatDate(J.draft.created_at)),1)]),J.draft.updated_at!==J.draft.created_at?((0,i.uX)(),(0,i.CE)("span",k,[t[11]||(t[11]=(0,i.Lk)("i",{class:"el-icon-edit-outline"},null,-1)),(0,i.eW)(" 更新于: "+(0,s.v_)(K.formatDate(J.draft.updated_at)),1)])):(0,i.Q3)("",!0),(0,i.Lk)("span",h,[(0,i.bF)(Y,{size:"small",class:(0,s.C4)("lang-tag-"+K.getNormalizedLanguage(J.draft.language))},{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(K.getDisplayLanguage(J.draft.language)),1)])),_:1},8,["class"])]),(0,i.Lk)("span",m,[(0,i.bF)(Y,{size:"small",type:"warning"},{default:(0,i.k6)((()=>t[12]||(t[12]=[(0,i.eW)("已删除")]))),_:1}),(0,i.bF)(Y,{size:"small",type:"info"},{default:(0,i.k6)((()=>t[13]||(t[13]=[(0,i.eW)("草稿")]))),_:1})])]),(0,i.Lk)("div",{ref:"markdownContent",class:"markdown-content",innerHTML:K.compiledMarkdown},null,8,_)])),_:1})]),(0,i.Lk)("div",y,[(0,i.bF)(ee,{class:"question-info-card"},{default:(0,i.k6)((()=>[(0,i.Lk)("h2",{onClick:t[0]||(t[0]=e=>K.goToProblem(J.draft.question_id)),class:"clickable-title"},[(0,i.eW)((0,s.v_)(J.questionDetails?.name||`题目 #${J.draft.question_id}`)+" ",1),t[14]||(t[14]=(0,i.Lk)("i",{class:"el-icon-link"},null,-1))]),(0,i.Lk)("div",b,[(0,i.Lk)("div",null,"题目ID: "+(0,s.v_)(J.draft.question_id),1),J.questionDetails?.ext_question_id?((0,i.uX)(),(0,i.CE)("div",D,"外部ID: "+(0,s.v_)(J.questionDetails.ext_question_id),1)):(0,i.Q3)("",!0),J.questionDetails?.oj_platform?((0,i.uX)(),(0,i.CE)("div",v,[t[15]||(t[15]=(0,i.eW)(" 平台: ")),(0,i.bF)(Y,{type:K.getPlatformTagType(J.questionDetails.oj_platform),size:"small"},{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(K.getPlatformName(J.questionDetails.oj_platform)),1)])),_:1},8,["type"])])):(0,i.Q3)("",!0)]),K.canManageDraft?((0,i.uX)(),(0,i.CE)("div",L,[(0,i.bF)(ie,{type:"warning",size:"small",onClick:K.handleRestore},{default:(0,i.k6)((()=>[(0,i.bF)(ae,null,{default:(0,i.k6)((()=>[(0,i.bF)(te)])),_:1}),t[16]||(t[16]=(0,i.eW)(" 恢复 "))])),_:1},8,["onClick"]),(0,i.bF)(ie,{type:"primary",size:"small",onClick:K.handleEdit},{default:(0,i.k6)((()=>[(0,i.bF)(ae,null,{default:(0,i.k6)((()=>[(0,i.bF)(se)])),_:1}),t[17]||(t[17]=(0,i.eW)(" 编辑 "))])),_:1},8,["onClick"]),(0,i.bF)(ie,{type:"info",size:"small",onClick:t[1]||(t[1]=e=>K.goToProblem(J.draft.question_id))},{default:(0,i.k6)((()=>[(0,i.bF)(ae,null,{default:(0,i.k6)((()=>[(0,i.bF)(le)])),_:1}),t[18]||(t[18]=(0,i.eW)(" 查看题目 "))])),_:1})])):(0,i.Q3)("",!0)])),_:1}),J.questionDetails?((0,i.uX)(),(0,i.Wv)(ee,{key:0,class:"question-tags-card"},{default:(0,i.k6)((()=>[(0,i.Lk)("div",C,[t[19]||(t[19]=(0,i.Lk)("h3",null,"难度级别",-1)),(0,i.bF)(Y,{type:K.getDifficultyTagType(J.questionDetails),effect:"dark"},{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(J.questionDetails.difficulty),1)])),_:1},8,["type"])]),J.questionDetails.algorithm_tags?.length?((0,i.uX)(),(0,i.CE)("div",q,[t[20]||(t[20]=(0,i.Lk)("h3",null,"算法标签",-1)),(0,i.Lk)("div",F,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(J.questionDetails.algorithm_tags,(e=>((0,i.uX)(),(0,i.Wv)(Y,{key:e,type:K.getTagType(e,J.questionDetails.oj_platform),class:"algorithm-tag"},{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(K.getTagName(e)),1)])),_:2},1032,["type"])))),128))])])):(0,i.Q3)("",!0)])),_:1})):(0,i.Q3)("",!0)])])):((0,i.uX)(),(0,i.CE)("div",w,[(0,i.Lk)("div",W,[(0,i.bF)(ee,{class:"draft-description-card"},{default:(0,i.k6)((()=>[(0,i.Lk)("h1",T,"题目 #"+(0,s.v_)(J.draft.question_id)+" 的解题思路（草稿）",1),(0,i.Lk)("div",V,[(0,i.Lk)("span",E,[t[21]||(t[21]=(0,i.Lk)("i",{class:"el-icon-time"},null,-1)),(0,i.eW)(" 创建于: "+(0,s.v_)(K.formatDate(J.draft.created_at)),1)]),J.draft.updated_at!==J.draft.created_at?((0,i.uX)(),(0,i.CE)("span",X,[t[22]||(t[22]=(0,i.Lk)("i",{class:"el-icon-edit-outline"},null,-1)),(0,i.eW)(" 更新于: "+(0,s.v_)(K.formatDate(J.draft.updated_at)),1)])):(0,i.Q3)("",!0),(0,i.Lk)("span",A,[(0,i.bF)(Y,{size:"small",class:(0,s.C4)("lang-tag-"+K.getNormalizedLanguage(J.draft.language))},{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(K.getDisplayLanguage(J.draft.language)),1)])),_:1},8,["class"])]),(0,i.Lk)("span",z,[(0,i.bF)(Y,{size:"small",type:"info"},{default:(0,i.k6)((()=>t[23]||(t[23]=[(0,i.eW)("草稿")]))),_:1})])]),(0,i.Lk)("div",{ref:"markdownContent",class:"markdown-content",innerHTML:K.compiledMarkdown},null,8,P)])),_:1})]),(0,i.Lk)("div",Q,[(0,i.bF)(ee,{class:"question-info-card"},{default:(0,i.k6)((()=>[(0,i.Lk)("h2",{onClick:t[2]||(t[2]=e=>K.goToProblem(J.draft.question_id)),class:"clickable-title"},[(0,i.eW)((0,s.v_)(J.questionDetails?.name||`题目 #${J.draft.question_id}`)+" ",1),t[24]||(t[24]=(0,i.Lk)("i",{class:"el-icon-link"},null,-1))]),(0,i.Lk)("div",j,[(0,i.Lk)("div",null,"题目ID: "+(0,s.v_)(J.draft.question_id),1),J.questionDetails?.ext_question_id?((0,i.uX)(),(0,i.CE)("div",$,"外部ID: "+(0,s.v_)(J.questionDetails.ext_question_id),1)):(0,i.Q3)("",!0),J.questionDetails?.oj_platform?((0,i.uX)(),(0,i.CE)("div",M,[t[25]||(t[25]=(0,i.eW)(" 平台: ")),(0,i.bF)(Y,{type:K.getPlatformTagType(J.questionDetails.oj_platform),size:"small"},{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(K.getPlatformName(J.questionDetails.oj_platform)),1)])),_:1},8,["type"])])):(0,i.Q3)("",!0)]),K.canManageDraft?((0,i.uX)(),(0,i.CE)("div",N,[J.draft.is_deleted?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.Wv)(ie,{key:0,type:"success",size:"small",onClick:K.handlePublish},{default:(0,i.k6)((()=>[(0,i.bF)(ae,null,{default:(0,i.k6)((()=>[(0,i.bF)(ne)])),_:1}),t[26]||(t[26]=(0,i.eW)(" 发布 "))])),_:1},8,["onClick"])),(0,i.bF)(ie,{type:"primary",size:"small",onClick:K.handleEdit},{default:(0,i.k6)((()=>[(0,i.bF)(ae,null,{default:(0,i.k6)((()=>[(0,i.bF)(se)])),_:1}),t[27]||(t[27]=(0,i.eW)(" 编辑 "))])),_:1},8,["onClick"]),J.draft.is_deleted?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.Wv)(ie,{key:1,type:"danger",size:"small",onClick:K.handleDelete},{default:(0,i.k6)((()=>[(0,i.bF)(ae,null,{default:(0,i.k6)((()=>[(0,i.bF)(oe)])),_:1}),t[28]||(t[28]=(0,i.eW)(" 删除 "))])),_:1},8,["onClick"])),J.draft.is_deleted?((0,i.uX)(),(0,i.Wv)(ie,{key:2,type:"warning",size:"small",onClick:K.handleRestore},{default:(0,i.k6)((()=>[(0,i.bF)(ae,null,{default:(0,i.k6)((()=>[(0,i.bF)(te)])),_:1}),t[29]||(t[29]=(0,i.eW)(" 恢复 "))])),_:1},8,["onClick"])):(0,i.Q3)("",!0),(0,i.bF)(ie,{type:"info",size:"small",onClick:t[3]||(t[3]=e=>K.goToProblem(J.draft.question_id))},{default:(0,i.k6)((()=>[(0,i.bF)(ae,null,{default:(0,i.k6)((()=>[(0,i.bF)(le)])),_:1}),t[30]||(t[30]=(0,i.eW)(" 查看题目 "))])),_:1})])):(0,i.Q3)("",!0)])),_:1}),J.questionDetails?((0,i.uX)(),(0,i.Wv)(ee,{key:0,class:"question-tags-card"},{default:(0,i.k6)((()=>[(0,i.Lk)("div",I,[t[31]||(t[31]=(0,i.Lk)("h3",null,"难度级别",-1)),(0,i.bF)(Y,{type:K.getDifficultyTagType(J.questionDetails),effect:"dark"},{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(J.questionDetails.difficulty),1)])),_:1},8,["type"])]),J.questionDetails.algorithm_tags?.length?((0,i.uX)(),(0,i.CE)("div",R,[t[32]||(t[32]=(0,i.Lk)("h3",null,"算法标签",-1)),(0,i.Lk)("div",U,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(J.questionDetails.algorithm_tags,(e=>((0,i.uX)(),(0,i.Wv)(Y,{key:e,type:K.getTagType(e,J.questionDetails.oj_platform),class:"algorithm-tag"},{default:(0,i.k6)((()=>[(0,i.eW)((0,s.v_)(K.getTagName(e)),1)])),_:2},1032,["type"])))),128))])])):(0,i.Q3)("",!0)])),_:1})):(0,i.Q3)("",!0)])]))]),(0,i.bF)(re,{modelValue:J.deleteDialogVisible,"onUpdate:modelValue":t[5]||(t[5]=e=>J.deleteDialogVisible=e),title:"确认删除",width:"30%"},{footer:(0,i.k6)((()=>[(0,i.Lk)("span",S,[(0,i.bF)(ie,{onClick:t[4]||(t[4]=e=>J.deleteDialogVisible=!1)},{default:(0,i.k6)((()=>t[33]||(t[33]=[(0,i.eW)("取消")]))),_:1}),(0,i.bF)(ie,{type:"danger",onClick:K.confirmDelete,loading:J.processing},{default:(0,i.k6)((()=>t[34]||(t[34]=[(0,i.eW)("确认删除")]))),_:1},8,["onClick","loading"])])])),default:(0,i.k6)((()=>[t[35]||(t[35]=(0,i.Lk)("span",null,"确定要删除这篇草稿吗？此操作不可逆。",-1))])),_:1},8,["modelValue"]),(0,i.bF)(re,{modelValue:J.restoreDialogVisible,"onUpdate:modelValue":t[7]||(t[7]=e=>J.restoreDialogVisible=e),title:"确认恢复",width:"30%"},{footer:(0,i.k6)((()=>[(0,i.Lk)("span",H,[(0,i.bF)(ie,{onClick:t[6]||(t[6]=e=>J.restoreDialogVisible=!1)},{default:(0,i.k6)((()=>t[36]||(t[36]=[(0,i.eW)("取消")]))),_:1}),(0,i.bF)(ie,{type:"primary",onClick:K.confirmRestore,loading:J.processing},{default:(0,i.k6)((()=>t[37]||(t[37]=[(0,i.eW)("确认恢复")]))),_:1},8,["onClick","loading"])])])),default:(0,i.k6)((()=>[t[38]||(t[38]=(0,i.Lk)("span",null,"确定要恢复这篇草稿吗？",-1))])),_:1},8,["modelValue"]),(0,i.bF)(re,{modelValue:J.publishDialogVisible,"onUpdate:modelValue":t[9]||(t[9]=e=>J.publishDialogVisible=e),title:"确认发布",width:"30%"},{footer:(0,i.k6)((()=>[(0,i.Lk)("span",O,[(0,i.bF)(ie,{onClick:t[8]||(t[8]=e=>J.publishDialogVisible=!1)},{default:(0,i.k6)((()=>t[39]||(t[39]=[(0,i.eW)("取消")]))),_:1}),(0,i.bF)(ie,{type:"success",onClick:K.confirmPublish,loading:J.processing},{default:(0,i.k6)((()=>t[40]||(t[40]=[(0,i.eW)("确认发布")]))),_:1},8,["onClick","loading"])])])),default:(0,i.k6)((()=>[t[41]||(t[41]=(0,i.Lk)("span",null,"确定要将此草稿发布为正式题解吗？",-1))])),_:1},8,["modelValue"])])}a(4114),a(8111),a(2489),a(1701);var J=a(6493),K=a(8121),G=a(2846),Z=a(1184),B=a(642),Y=a(8353),ee=a(7477),te=a(1219),ae={name:"DraftDetailView",components:{AppHeader:J.A,EditPen:ee.EDh,Delete:ee.epd,View:ee.Ss2,RefreshLeft:ee.Zck,Upload:ee._OO},data(){return{draftId:this.$route.params.id,draft:null,questionDetails:null,loading:!0,error:null,mdi:new B.A({html:!0,linkify:!0,typographer:!0,breaks:!0}),currentUserId:null,deleteDialogVisible:!1,restoreDialogVisible:!1,publishDialogVisible:!1,processing:!1,languageDisplayMap:{cpp:"C++",csharp:"C#",javascript:"JavaScript",python:"Python",java:"Java",go:"Go",rust:"Rust"}}},computed:{compiledMarkdown(){if(!this.draft)return"";try{const e=String(this.draft.content_text||""),t=this.mdi.render(e);return Y.A.sanitize(t)}catch(e){return console.error("Markdown处理错误:",e),"内容解析出错"}},canManageDraft(){return!0}},mounted(){this.fetchDraftDetail()},methods:{async fetchDraftDetail(){this.loading=!0,this.error=null;try{const e=await(0,K.n6)(this.draftId,!0);e.data&&200===e.data.code?this.draft=e.data.data:this.draft=e.data,this.draft&&this.draft.question_id&&await this.fetchQuestionDetail(this.draft.question_id)}catch(e){console.error("获取草稿详情失败:",e),this.error="获取草稿详情失败: "+(e.message||"未知错误")}finally{this.loading=!1}},async fetchQuestionDetail(e){try{const t=await(0,G.so)(e);t.data&&200===t.data.code?this.questionDetails=t.data.data:this.questionDetails=t.data,this.questionDetails&&"string"===typeof this.questionDetails.algorithm_tags&&(this.questionDetails.algorithm_tags=this.questionDetails.algorithm_tags.split(",").map((e=>e.trim())).filter((e=>e.length>0)))}catch(t){console.error("获取题目详情失败:",t)}},handleEdit(){this.draft&&this.$router.push(`/${this.draft.id}/drafts/update`)},handleDelete(){this.draft&&!this.draft.is_deleted&&(this.deleteDialogVisible=!0)},handleRestore(){this.draft&&(this.restoreDialogVisible=!0)},handlePublish(){this.draft&&!this.draft.is_deleted&&(this.publishDialogVisible=!0)},async confirmDelete(){if(this.draft){this.processing=!0;try{const e=await(0,Z.A)({url:"/api/solution/delete/",method:"post",data:{id:this.draft.id}});this.deleteDialogVisible=!1,(0,te.nk)({type:"success",message:e.message||"草稿删除成功"}),await this.fetchDraftDetail()}catch(e){console.error("删除草稿失败:",e);const t=e.response?.data?.message||e.message||"删除失败: 未知错误";(0,te.nk)({type:"error",message:t})}finally{this.processing=!1}}},async confirmRestore(){if(this.draft){this.processing=!0;try{const e=await(0,Z.A)({url:"/api/solution/restore/",method:"post",data:{id:this.draft.id}});this.restoreDialogVisible=!1,(0,te.nk)({type:"success",message:e.message||"草稿恢复成功"}),await this.fetchDraftDetail()}catch(e){console.error("恢复草稿失败:",e);const t=e.response?.data?.message||e.message||"恢复失败: 未知错误";(0,te.nk)({type:"error",message:t})}finally{this.processing=!1}}},async confirmPublish(){if(this.draft&&!this.draft.is_deleted){this.processing=!0;try{const{data:e}=await(0,Z.A)({url:"/api/solution/pub/",method:"post",data:{id:this.draft.id}});if(this.publishDialogVisible=!1,200!==e.code)throw new Error(e.message||`发布失败，错误码：${e.code}`);{(0,te.nk)({type:"success",message:e.message||"发布成功"});const t=e.data?.id;t?this.$router.push(`/${t}/solutions`):this.$router.push("/solutions")}}catch(e){console.error("发布失败:",e),(0,te.nk)({type:"error",message:e.message||"发布过程中发生未知错误"})}finally{this.processing=!1}}},goToProblem(e){this.$router.push(`/${e}/problems`)},formatDate(e){if(!e)return"未知时间";const t=new Date(e);return t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},getNormalizedLanguage(e){if(!e)return"";const t=e.toLowerCase(),a={cpp:"c++",csharp:"c#"};return a[t]||t},getDisplayLanguage(e){if(!e)return"";const t=e.toLowerCase();return this.languageDisplayMap[t]?this.languageDisplayMap[t]:e.charAt(0).toUpperCase()+e.slice(1)},getPlatformName(e){const t={luogu:"洛谷",leetcode:"LeetCode"};return t[e]||e},getPlatformTagType(e){return{luogu:"success",leetcode:"warning"}[e]||"info"},getDifficultyTagType(e){if("luogu"===e.oj_platform){const t={"入门":"info","普及-":"success","普及/提高-":"success","普及+/提高":"warning","提高+/省选-":"danger","省选/NOI-":"danger","NOI/NOI+":"danger",CTSC:"danger"};return t[e.difficulty]||"info"}return{"简单":"success","中等":"warning","困难":"danger"}[e.difficulty]||"info"},getTagType(e,t){if("leetcode"===t)return"primary";const a=e.split("_")[0];return{Algorithm:"primary",Source:"success",Time:"warning",Region:"danger",Other:"info"}[a]||"info"},getTagName(e){const t=e.split("_");return t.length>1?t.slice(1).join("_"):e}}},ie=a(1241);const se=(0,ie.A)(ae,[["render",x],["__scopeId","data-v-6395d0bd"]]);var le=se},8121:function(e,t,a){a.d(t,{J1:function(){return c},Nc:function(){return r},R1:function(){return f},S1:function(){return n},Tu:function(){return u},Up:function(){return s},_n:function(){return l},jA:function(){return g},n6:function(){return d},uA:function(){return o}});var i=a(1184);function s(e){return(0,i.A)({url:"/api/solutions/",method:"get",params:e})}function l(e){return(0,i.A)({url:"/api/solutions/trash/",method:"get",params:e})}function n(e){return(0,i.A)({url:"/api/drafts/",method:"get",params:e})}function o(e){return(0,i.A)({url:"/api/drafts/trash/",method:"get",params:e})}function r(e){return(0,i.A)({url:`/solutions/${e}/`,method:"get"})}function d(e){return(0,i.A)({url:`/drafts/${e}/`,method:"get"})}function u(e){return(0,i.A)({url:"/api/solution/create/",method:"post",data:e})}function c(e){return(0,i.A)({url:"/api/solution/draft/",method:"post",data:e})}function f(e,t){return(0,i.A)({url:`/solutions/${e}/update/`,method:"put",data:t})}function g(e,t){return(0,i.A)({url:`/drafts/${e}/update/`,method:"put",data:t})}}}]);
//# sourceMappingURL=699.56f18ebc.js.map