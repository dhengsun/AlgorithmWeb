"use strict";(self["webpackChunkvue_django_frontend"]=self["webpackChunkvue_django_frontend"]||[]).push([[739],{7739:function(e,t,a){a.r(t),a.d(t,{default:function(){return _}});var n=a(6768),o=a(5130);const s={class:"create-solution-view"},i={class:"page-container"},r={class:"question-input"},l={class:"markdown-editor"},u=["innerHTML"];function d(e,t,a,d,m,c){const h=(0,n.g2)("AppHeader"),f=(0,n.g2)("el-input"),p=(0,n.g2)("el-button"),g=(0,n.g2)("el-form-item"),b=(0,n.g2)("el-tab-pane"),k=(0,n.g2)("el-tabs"),_=(0,n.g2)("el-form");return(0,n.uX)(),(0,n.CE)("div",s,[(0,n.bF)(h),(0,n.Lk)("main",i,[t[9]||(t[9]=(0,n.Lk)("h1",null,"新建题解",-1)),(0,n.bF)(_,{model:m.form,"label-width":"120px",class:"solution-form"},{default:(0,n.k6)((()=>[(0,n.bF)(g,{label:"题目ID"},{default:(0,n.k6)((()=>[(0,n.Lk)("div",r,[(0,n.bF)(f,{modelValue:m.form.question_id,"onUpdate:modelValue":t[0]||(t[0]=e=>m.form.question_id=e),placeholder:"输入题目ID",onBlur:c.fetchQuestionInfo},null,8,["modelValue","onBlur"]),(0,n.bF)(p,{type:"primary",icon:"el-icon-link",disabled:!m.form.question_id,onClick:c.goToProblem,title:"前往题目页面"},{default:(0,n.k6)((()=>t[5]||(t[5]=[(0,n.eW)(" 查看题目 ")]))),_:1},8,["disabled","onClick"])])])),_:1}),(0,n.bF)(g,{label:"题目名称"},{default:(0,n.k6)((()=>[(0,n.bF)(f,{modelValue:m.form.question_name,"onUpdate:modelValue":t[1]||(t[1]=e=>m.form.question_name=e),disabled:"",placeholder:"获取题目名称"},null,8,["modelValue"])])),_:1}),(0,n.bF)(g,{label:"语言类型"},{default:(0,n.k6)((()=>[(0,n.bF)(f,{modelValue:m.form.language,"onUpdate:modelValue":t[2]||(t[2]=e=>m.form.language=e),placeholder:"例如: C++, Python, Java"},null,8,["modelValue"])])),_:1}),(0,n.bF)(g,{label:"题解内容"},{default:(0,n.k6)((()=>[(0,n.Lk)("div",l,[(0,n.bF)(k,{modelValue:m.activeTab,"onUpdate:modelValue":t[4]||(t[4]=e=>m.activeTab=e)},{default:(0,n.k6)((()=>[(0,n.bF)(b,{label:"编辑",name:"edit"},{default:(0,n.k6)((()=>[(0,n.bo)((0,n.Lk)("textarea",{"onUpdate:modelValue":t[3]||(t[3]=e=>m.form.content=e),class:"editor-textarea",placeholder:"输入题解内容（Markdown格式）"},null,512),[[o.Jo,m.form.content]])])),_:1}),(0,n.bF)(b,{label:"预览",name:"preview"},{default:(0,n.k6)((()=>[(0,n.Lk)("div",{class:"markdown-preview",innerHTML:c.compiledMarkdown},null,8,u)])),_:1})])),_:1},8,["modelValue"])])])),_:1}),(0,n.bF)(g,null,{default:(0,n.k6)((()=>[(0,n.bF)(p,{type:"primary",onClick:c.publishSolutionAction,loading:m.publishing},{default:(0,n.k6)((()=>t[6]||(t[6]=[(0,n.eW)("发布")]))),_:1},8,["onClick","loading"]),(0,n.bF)(p,{type:"info",onClick:c.saveDraftManually,loading:m.manuallySaving},{default:(0,n.k6)((()=>t[7]||(t[7]=[(0,n.eW)("保存草稿")]))),_:1},8,["onClick","loading"]),(0,n.bF)(p,{onClick:c.resetForm},{default:(0,n.k6)((()=>t[8]||(t[8]=[(0,n.eW)("重置")]))),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])])])}a(4114);var m=a(6493),c=a(2846),h=a(8121),f=a(642),p=a(8353),g={name:"CreateSolutionView",components:{AppHeader:m.A},data(){return{activeTab:"edit",fetching:!1,publishing:!1,manuallySaving:!1,mdi:new f.A({html:!0,linkify:!0,typographer:!0}),form:{question_id:"",question_name:"",language:"",content:""},mathJaxLoaded:!1,draftId:null}},computed:{compiledMarkdown(){try{const e=String(this.form.content||""),t=this.mdi.render(e);return p.A.sanitize(t)}catch(e){return console.error("Markdown处理错误:",e),"内容解析出错"}}},watch:{activeTab(e){"preview"===e&&(this.initMathJax(),this.$nextTick((()=>this.renderMathJax())))},"form.content"(){"preview"===this.activeTab&&this.mathJaxLoaded&&this.$nextTick((()=>this.renderMathJax()))}},mounted(){this.initMathJax()},methods:{goToProblem(){this.form.question_id&&this.$router.push(`/${this.form.question_id}/problems`)},renderMathJax(){"undefined"!==typeof MathJax&&MathJax.typesetPromise&&MathJax.typesetPromise()},initMathJax(){if(this.mathJaxLoaded||"undefined"!==typeof MathJax)return void(this.mathJaxLoaded=!0);window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre","code"]},startup:{ready:()=>{MathJax.startup.defaultReady(),this.mathJaxLoaded=!0,"preview"===this.activeTab&&this.$nextTick((()=>this.renderMathJax()))}}};const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js",e.async=!0,e.onload=()=>{this.mathJaxLoaded=!0},document.head.appendChild(e)},async fetchQuestionInfo(){if(this.form.question_id){this.fetching=!0;try{const e=await(0,c.so)(this.form.question_id);this.form.question_name=e.data.name}catch(e){console.error("获取题目信息失败:",e),this.$message.error("获取题目信息失败: "+(e.message||"未知错误")),this.form.question_name=""}finally{this.fetching=!1}}else this.form.question_name=""},async saveDraftManually(){if(this.validateForm(!0)){this.manuallySaving=!0;try{const e={question_id:this.form.question_id,language:this.form.language,content:this.form.content};console.log("发送草稿保存请求:",e);const t=await(0,h.J1)(e);console.log("草稿保存响应:",t.data),t.data&&200===t.data.code?(this.draftId=t.data.data.id,this.$message.success("草稿保存成功")):this.$message.error(t.data&&t.data.message||"保存失败")}catch(e){console.error("保存草稿失败:",e),e.response&&e.response.data?(console.log("错误响应详情:",e.response.data),this.$message.error(e.response.data.message||"保存失败")):this.$message.error(e.message||"保存失败")}finally{this.manuallySaving=!1}}},async publishSolutionAction(){if(this.validateForm()){this.publishing=!0;try{const e={question_id:this.form.question_id,language:this.form.language,content:this.form.content};console.log("发布题解请求:",e);const t=await(0,h.Tu)(e);console.log("发布题解响应:",t.data),t.data&&200===t.data.code?this.$message.success("题解发布成功"):this.$message.error(t.data&&t.data.message||"发布失败")}catch(e){console.error("发布题解失败:",e),e.response&&e.response.data?(console.log("错误响应详情:",e.response.data),this.$message.error(e.response.data.message||"发布失败")):this.$message.error(e.message||"发布失败")}finally{this.publishing=!1}}},validateForm(e=!1){return this.form.question_id?this.form.question_name||e?this.form.language?!!this.form.content||(this.$message.error("请输入题解内容"),!1):(this.$message.error("请输入语言类型"),!1):(this.$message.error("题目ID无效或未获取到题目名称"),!1):(this.$message.error("请输入题目ID"),!1)},resetForm(){this.form={question_id:"",question_name:"",language:"",content:""},this.draftId=null}}},b=a(1241);const k=(0,b.A)(g,[["render",d],["__scopeId","data-v-61c57d92"]]);var _=k},8121:function(e,t,a){a.d(t,{J1:function(){return m},Nc:function(){return l},R1:function(){return c},S1:function(){return i},Tu:function(){return d},Up:function(){return o},_n:function(){return s},jA:function(){return h},n6:function(){return u},uA:function(){return r}});var n=a(1184);function o(e){return(0,n.A)({url:"/api/solutions/",method:"get",params:e})}function s(e){return(0,n.A)({url:"/api/solutions/trash/",method:"get",params:e})}function i(e){return(0,n.A)({url:"/api/drafts/",method:"get",params:e})}function r(e){return(0,n.A)({url:"/api/drafts/trash/",method:"get",params:e})}function l(e){return(0,n.A)({url:`/solutions/${e}/`,method:"get"})}function u(e){return(0,n.A)({url:`/drafts/${e}/`,method:"get"})}function d(e){return(0,n.A)({url:"/api/solution/create/",method:"post",data:e})}function m(e){return(0,n.A)({url:"/api/solution/draft/",method:"post",data:e})}function c(e,t){return(0,n.A)({url:`/solutions/${e}/update/`,method:"put",data:t})}function h(e,t){return(0,n.A)({url:`/drafts/${e}/update/`,method:"put",data:t})}}}]);
//# sourceMappingURL=739.d62a35c2.js.map